package com.example.mathassistant.data

import android.content.Context
import android.net.Uri
import java.io.File

/**
 * 视频管理器
 * 管理teaching video文件夹中的视频文件与知识点的对应关系
 */
object VideoManager {
    
    /**
     * 根据知识点标题查找对应的视频文件
     */
    fun getVideoForKnowledgePoint(knowledgePointTitle: String): String? {
        return videoMapping[knowledgePointTitle]
    }
    
    /**
     * 获取视频文件的完整路径（从assets目录）
     */
    fun getVideoPath(context: Context, fileName: String): String {
        // 使用正确的assets路径格式
        return "android.resource://${context.packageName}/raw/$fileName"
    }
    
    /**
     * 获取视频文件的assets路径（用于直接读取）
     */
    fun getVideoAssetPath(fileName: String): String {
        return "teaching_video/$fileName"
    }
    
    /**
     * 检查视频文件是否在assets目录中存在
     */
    fun isVideoAvailable(context: Context, fileName: String): Boolean {
        return try {
            context.assets.list("teaching_video")?.contains(fileName) == true
        } catch (e: Exception) {
            false
        }
    }
    
    /**
     * 从assets目录获取视频文件列表
     */
    fun getAvailableVideos(context: Context): List<String> {
        return try {
            context.assets.list("teaching_video")?.filter { it.endsWith(".mp4") } ?: emptyList()
        } catch (e: Exception) {
            emptyList()
        }
    }
    
    /**
     * 视频文件与知识点的映射关系
     * 基于KnowledgePointManager中的知识点标题进行精确匹配
     */
    private val videoMapping = mapOf(
        // 一年级（上）知识点
        "0-10各数的认识和加减法" to "一年级（上）01.1~10各数的初步认识.mp4",
        "位置与顺序" to "一年级（上）03.前后.mp4",
        "认识钟表" to "一年级（上）05.左右.mp4",
        
        // 一年级（下）知识点
        "20以内数的认识和加减法" to "一年级（下）01.认识平面图形.mp4",
        "认识图形（一）" to "一年级（下）01.认识平面图形.mp4",
        
        // 二年级（上）知识点
        "100以内数的认识和加减法（二）" to "二上  07.两位数与两位数的竖式加法（不进位）.mp4",
        "表内乘法（一）" to "二上  08.两位数加两位数（不进位）.mp4",
        "认识图形（二）" to "二上  06.长度单位分米、厘米和毫米.mp4",
        "观察物体" to "二上  05.长度单位米.mp4",
        "统计与概率" to "二年级（下）01.记录调查数据（一）.mp4",
        
        // 二年级（下）知识点
        "100以内数的认识和加减法（三）" to "二年级（下）02.记录调查数据（二）.mp4",
        "表内除法（一）" to "二年级（下）06.认识除法的意义.mp4",
        "图形与变换" to "二年级（下）08.初步认识轴对称现象.mp4",
        "万以内数的认识" to "二年级（下）25.整十数、整百数的减法.mp4",
        "克和千克" to "二年级（下）03.小数目物品平均分.mp4",
        "数学广角——推理" to "二年级（下）04.平均分的两种情况.mp4",
        
        // 三年级（上）知识点
        "时、分、秒" to "三上 01.时分秒的互化.mp4",
        "万以内的加法和减法（一）" to "三年级（下） 04.整十数除以一位数.mp4",
        "测量" to "三年级（下）05.两位数除以一位数.mp4",
        "多位数乘一位数" to "三年级（下）10.两位数乘整十数.mp4",
        "分数的初步认识" to "三年级（下）11.两位数乘两位数（一）.mp4",
        "四边形" to "三年级（下）12.两位数乘两位数（二）.mp4",
        "数学广角——集合" to "三年级（下）03.描述简单的线路图.mp4",
        
        // 三年级（下）知识点
        "位置与方向（一）" to "三年级（下）01.认识东南西北.mp4",
        "除数是一位数的除法" to "三年级（下）05.两位数除以一位数.mp4",
        "复式统计表" to "三年级（下）02.认识东北、东南、西南、西北.mp4",
        "两位数乘两位数" to "三年级（下）11.两位数乘两位数（一）.mp4",
        "面积" to "三年级（下）12.两位数乘两位数（二）.mp4",
        "年、月、日" to "三年级（下）03.描述简单的线路图.mp4",
        "小数的初步认识" to "三年级（下）04.整十数除以一位数.mp4",
        "数学广角——搭配（二）" to "三年级（下）06.列竖式计算之两位数除以一位数（上）.mp4",
        
        // 四年级（上）知识点
        "大数的认识" to "四年级（下）01.四则混合运算的顺序.mp4",
        "公顷和平方千米" to "四年级（下）02.设计最省钱方案.mp4",
        "角的度量" to "四年级（下）03.从不同位置观察立体图形.mp4",
        "三位数乘两位数" to "四年级（下）04.加法交换律.mp4",
        "平行四边形和梯形" to "四年级（下）05.加法结合律.mp4",
        "除数是两位数的除法" to "四年级（下）06.乘法交换律.mp4",
        "条形统计图" to "四年级（下）07.乘法结合律.mp4",
        "数学广角——优化" to "四年级（下）08.乘法分配律.mp4",
        
        // 四年级（下）知识点
        "四则运算" to "四年级（下）01.四则混合运算的顺序.mp4",
        "观察物体（二）" to "四年级（下）03.从不同位置观察立体图形.mp4",
        "运算定律" to "四年级（下）04.加法交换律.mp4",
        "小数的意义和性质" to "四年级（下）09.小数的意义（一）.mp4",
        "三角形" to "四年级（下）10.小数的性质.mp4",
        "小数的加法和减法" to "四年级（下）11.小数的大小比较.mp4",
        "图形的运动（二）" to "四年级（下）12.小数点的移动.mp4",
        "平均数与条形统计图" to "四年级（下）02.设计最省钱方案.mp4",
        "数学广角——鸡兔同笼" to "四年级（下）05.加法结合律.mp4",
        
        // 五年级（上）知识点
        "小数乘法" to "五上 07.小数除以一位整数（上）.mp4",
        "位置" to "五上 08.小数除以一位整数（中）.mp4",
        "小数除法" to "五上 07.小数除以一位整数（上）.mp4",
        "可能性" to "五上 08.小数除以一位整数（中）.mp4",
        "简易方程" to "五上 07.小数除以一位整数（上）.mp4",
        "多边形的面积" to "五上 08.小数除以一位整数（中）.mp4",
        "数学广角——植树问题" to "五上 07.小数除以一位整数（上）.mp4",
        
        // 五年级（下）知识点
        "观察物体（三）" to "五年级（下）01.按要求搭立体图形.mp4",
        "因数与倍数" to "五年级（下）06.倍数与因数.mp4",
        "长方体和正方体" to "五年级（下）13.长方体的认识.mp4",
        "分数的意义和性质" to "五年级（下）12.质数与合数.mp4",
        "图形的运动（三）" to "五年级（下）04.观察的范围.mp4",
        "分数的加法和减法" to "五年级（下）05.天安门广场.mp4",
        "打电话" to "五年级（下）03.简单搭积木比赛.mp4",
        
        // 六年级（上）知识点
        "分数乘法" to "六年级（下）10.比例的认识.mp4",
        "位置与方向（二）" to "六年级（下）11.比例的基本性质.mp4",
        "分数除法" to "六年级（下）12.解比例方程.mp4",
        "比" to "六年级（下）13.比例尺的认识.mp4",
        "圆" to "六年级（下）06.面的旋转.mp4",
        "百分数（一）" to "六年级（下）03.百分数的应用之折扣.mp4",
        "扇形统计图" to "六年级（下）04.百分数的应用之成数.mp4",
        "数学广角——数与形" to "六年级（下）05.百分数的应用之利率.mp4",
        
        // 六年级（下）知识点
        "负数" to "六年级（下）01.生活中的负数.mp4",
        "百分数（二）" to "六年级（下）03.百分数的应用之折扣.mp4",
        "圆柱与圆锥" to "六年级（下）09.圆锥的认识.mp4",
        "比例" to "六年级（下）10.比例的认识.mp4",
        "统计与概率" to "六年级（下）04.百分数的应用之成数.mp4",
        "数学思考" to "六年级（下）05.百分数的应用之利率.mp4",
        "综合与实践" to "六年级（下）06.面的旋转.mp4"
    )
    
    /**
     * 获取所有可用的视频文件列表
     */
    fun getAllVideoFiles(): List<String> {
        return videoMapping.values.toList()
    }
    
    /**
     * 获取所有知识点与视频的映射关系
     */
    fun getAllVideoMappings(): Map<String, String> {
        return videoMapping.toMap()
    }
}
